<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录了对将台式机从windows换位linux后折腾的各种内容">
<meta property="og:type" content="article">
<meta property="og:title" content="台式机改造计划">
<meta property="og:url" content="http://yoursite.com/2022/07/11/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/index.html">
<meta property="og:site_name" content="rain的随笔">
<meta property="og:description" content="记录了对将台式机从windows换位linux后折腾的各种内容">
<meta property="og:locale" content="zh">
<meta property="article:published_time" content="2022-07-11T11:08:52.000Z">
<meta property="article:modified_time" content="2022-12-05T14:19:07.985Z">
<meta property="article:author" content="rain">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="ntfs">
<meta property="article:tag" content="samba">
<meta property="article:tag" content="portainer">
<meta property="article:tag" content="KVM">
<meta property="article:tag" content="LXD">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2022/07/11/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh'
  };
</script>

  <title>台式机改造计划 | rain的随笔</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">rain的随笔</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">A secret base!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">106</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">9</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">88</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/07/11/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/images_lx/avatar_idenn.png">
      <meta itemprop="name" content="rain">
      <meta itemprop="description" content="记录一些关于数学、计算机的知识，以及一些日常。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rain的随笔">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          台式机改造计划
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-07-11 19:08:52" itemprop="dateCreated datePublished" datetime="2022-07-11T19:08:52+08:00">2022-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-12-05 22:19:07" itemprop="dateModified" datetime="2022-12-05T22:19:07+08:00">2022-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%98%E8%85%BE/" itemprop="url" rel="index"><span itemprop="name">折腾</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/07/11/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/07/11/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>记录了对将台式机从windows换位linux后折腾的各种内容</p>
<a id="more"></a>

<h3 id="linux挂载ntfs分区"><a href="#linux挂载ntfs分区" class="headerlink" title="linux挂载ntfs分区"></a>linux挂载ntfs分区</h3><ul>
<li><p>不考虑和windows兼容的话（在linux下创建的文件，在windows中会显示为其它用户导致无法访问）</p>
<ul>
<li>将own设置为指定用户和组</li>
<li>umask表示文件和目录权限哪些位为0，0022即755</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t ntfs-3g -o umask&#x3D;0022,gid&#x3D;1000,uid&#x3D;1000 &#x2F;dev&#x2F;sda2 &#x2F;home&#x2F;yfy&#x2F;D</span><br></pre></td></tr></table></figure>
</li>
<li><p>考虑和windows兼容（双系统），需要手动设置windows和linux用户映射。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t ntfs-3g -o usermapping&#x3D;&#x2F;home&#x2F;yfy&#x2F;UserMapping,umask&#x3D;0022,utf8 &#x2F;dev&#x2F;sda2 &#x2F;home&#x2F;yfy&#x2F;D</span><br></pre></td></tr></table></figure>
</li>
<li><p>其它</p>
<ul>
<li><p>umount占用失败</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount -l ... #lazy umount</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加到fstab自动挂载</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID&#x3D;7E3AF70F3AF6C367  &#x2F;home&#x2F;yfy&#x2F;D  ntfs  usermapping&#x3D;&#x2F;home&#x2F;yfy&#x2F;app&#x2F;ntfs-3g&#x2F;UserMapping,umask&#x3D;0022 0 0</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li><p>fstab格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Device] [Mount Point] [File System Type] [Options] [Dump] [Pass]</span><br></pre></td></tr></table></figure>
</li>
<li><p>device域</p>
<ul>
<li>Label : LABEL=label</li>
<li>Network ID<ul>
<li>Samba : //server/share</li>
<li>NFS : server:/share</li>
<li>SSHFS : sshfs#user@server:/share</li>
</ul>
</li>
<li>Device : /dev/sdxy (not recommended)</li>
</ul>
</li>
<li><p>获得UUID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo blkid</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>参考：</p>
<p>官方文档：<a href="http://manpages.ubuntu.com/manpages/xenial/en/man8/ntfs-3g.8.html" target="_blank" rel="noopener">Ubuntu Manpage: ntfs-3g - Third Generation Read/Write NTFS Driver</a></p>
<p>类似问题：<a href="https://askubuntu.com/a/514870" target="_blank" rel="noopener">https://askubuntu.com/a/514870</a></p>
<ul>
<li>回答：<a href="https://askubuntu.com/posts/514870/edit" target="_blank" rel="noopener">https://askubuntu.com/posts/514870/edit</a><ul>
<li>回答中提到的网页（因为原网页不在了，使用了webarchive）：<a href="https://web.archive.org/web/20200321035617/https://www.tuxera.com/community/ntfs-3g-advanced/ownership-and-permissions/" target="_blank" rel="noopener">Ownership and Permissions (archive.org)</a></li>
</ul>
</li>
</ul>
<p>fstab: <a href="https://help.ubuntu.com/community/Fstab" target="_blank" rel="noopener">Fstab - Community Help Wiki (ubuntu.com)</a></p>
</li>
</ul>
<h3 id="linux分享Samba"><a href="#linux分享Samba" class="headerlink" title="linux分享Samba"></a>linux分享Samba</h3><p><a href="https://ubuntu.com/tutorials/install-and-configure-samba#3-setting-up-samba" target="_blank" rel="noopener">https://ubuntu.com/tutorials/install-and-configure-samba#3-setting-up-samba</a></p>
<p><a href="https://kifarunix.com/easily-install-and-configure-samba-file-server-on-ubuntu-22-04/" target="_blank" rel="noopener">Easily Install and Configure Samba File Server on Ubuntu 22.04 - kifarunix.com</a></p>
<p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install samba</span><br></pre></td></tr></table></figure>

<p>设置共享目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo vim &#x2F;etc&#x2F;samba&#x2F;smb.conf</span><br><span class="line"></span><br><span class="line">[sambashare]</span><br><span class="line">    comment &#x3D; Samba on Ubuntu</span><br><span class="line">    path &#x3D; &#x2F;home&#x2F;username&#x2F;sambashare</span><br><span class="line">    read only &#x3D; no</span><br><span class="line">    browsable &#x3D; yes</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo service smbd restart</span><br><span class="line">#sudo ufw allow samba</span><br><span class="line"></span><br><span class="line">#添加用户并设置密码</span><br><span class="line">sudo smbpasswd -a username</span><br></pre></td></tr></table></figure>



<h3 id="命令行分区"><a href="#命令行分区" class="headerlink" title="命令行分区"></a>命令行分区</h3><h3 id="docker-portainer"><a href="#docker-portainer" class="headerlink" title="docker,portainer"></a>docker,portainer</h3><h4 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加源</span></span><br><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release</span><br><span class="line">    </span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">   <span class="string">"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> stable"</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line">   </span><br><span class="line"><span class="comment">#安装</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment">#sudo groupadd docker</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">docker info</span><br><span class="line">docker run --rm hello-world</span><br></pre></td></tr></table></figure>

<h4 id="安装portainer"><a href="#安装portainer" class="headerlink" title="安装portainer"></a>安装portainer</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker volume create portainer_data</span><br><span class="line"></span><br><span class="line">docker run -d -p 9001:8000 -p 9000:9000 --name portainer \</span><br><span class="line">    --restart&#x3D;always \</span><br><span class="line">    -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock \</span><br><span class="line">    -v portainer_data:&#x2F;data \</span><br><span class="line">    portainer&#x2F;portainer-ce</span><br></pre></td></tr></table></figure>



<h3 id="KVM-cockpit"><a href="#KVM-cockpit" class="headerlink" title="KVM, cockpit"></a>KVM, cockpit</h3><h4 id="KVM-install"><a href="#KVM-install" class="headerlink" title="KVM install"></a>KVM install</h4><p>KVM: <a href="https://linuxize.com/post/how-to-install-kvm-on-ubuntu-20-04/" target="_blank" rel="noopener">How to Install Kvm on Ubuntu 20.04 | Linuxize</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virtinst virt-manager</span><br></pre></td></tr></table></figure>

<ul>
<li><code>qemu-kvm</code> - software that provides hardware emulation for the KVM hypervisor.</li>
<li><code>libvirt-daemon-system</code> - configuration files to run the libvirt daemon as a system service.</li>
<li><code>libvirt-clients</code> - software for managing virtualization platforms.</li>
<li><code>bridge-utils</code> - a set of command-line tools for configuring ethernet bridges.</li>
<li><code>virtinst</code> - a set of command-line tools for creating virtual machines.</li>
<li><code>virt-manager</code> - an easy-to-use <strong>GUI interface</strong> and supporting command-line utilities for managing virtual machines through libvirt.</li>
</ul>
<p>brctl</p>
<blockquote>
<p>The “virbr0” bridge does not have any physical interfaces added. “virbr0-nic” is a virtual device with no traffic routed through it. The sole purpose of this device is to avoid changing the MAC address of the “virbr0” bridge.</p>
</blockquote>
<h4 id="KVM-install-win10"><a href="#KVM-install-win10" class="headerlink" title="KVM install win10"></a>KVM install win10</h4><p><a href="https://getlabsdone.com/install-windows-10-on-ubuntu-kvm/" target="_blank" rel="noopener">How To Install Windows 10 on Ubuntu KVM? – GetLabsDone</a></p>
<h4 id="CLI"><a href="#CLI" class="headerlink" title="CLI"></a>CLI</h4><p>参考：</p>
<ul>
<li><a href="https://computingforgeeks.com/virsh-commands-cheatsheet/" target="_blank" rel="noopener">Virsh commands cheatsheet to manage KVM guest virtual machines | ComputingForGeeks</a></li>
<li><a href="https://kallesplayground.wordpress.com/useful-stuff/commands-for-kvm-management/" target="_blank" rel="noopener">Commands for KVM hypervisor management | Kalle’s playground (wordpress.com)</a></li>
</ul>
<h5 id="基本"><a href="#基本" class="headerlink" title="基本"></a>基本</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#列出虚拟机(domain)</span><br><span class="line">virsh list		#active</span><br><span class="line">virsh list --all</span><br><span class="line"></span><br><span class="line">#查看虚拟机信息</span><br><span class="line">virsh dominfo vm_name</span><br><span class="line">virsh edit vm_name		#XML格式</span><br><span class="line"></span><br><span class="line">#开启、关闭</span><br><span class="line">virsh start	vm_name</span><br><span class="line">virsh shutdown vm_name	</span><br><span class="line">virsh reboot vm_name</span><br><span class="line">virsh destroy test		#强制关闭</span><br><span class="line">virsh autostart vm_name	#设置自动启动</span><br><span class="line">virsh autostart --disable vm_name	#关闭设置自动启动</span><br><span class="line"></span><br><span class="line">#挂起</span><br><span class="line">sudo virsh suspend test</span><br><span class="line">sudo virsh resume test</span><br></pre></td></tr></table></figure>

<h5 id="开启VNC"><a href="#开启VNC" class="headerlink" title="开启VNC"></a>开启VNC</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">virsh shutdown &lt;domain-name&gt;</span><br><span class="line">virsh edit &lt;domain-name&gt;</span><br><span class="line"></span><br><span class="line">#Add below XML contents within &lt;devices&gt; block</span><br><span class="line">&lt;graphics type&#x3D;&#39;vnc&#39; port&#x3D;&#39;-1&#39; autoport&#x3D;&#39;yes&#39; listen&#x3D;&#39;0.0.0.0&#39;&gt;</span><br><span class="line">  &lt;listen type&#x3D;&#39;address&#39; address&#x3D;&#39;0.0.0.0&#39;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;graphics&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Cockpit"><a href="#Cockpit" class="headerlink" title="Cockpit"></a>Cockpit</h4><p>Cockpit: <a href="https://www.linuxtechi.com/how-to-install-cockpit-on-ubuntu-20-04/" target="_blank" rel="noopener">How to Install Cockpit Web Console on Ubuntu 20.04 Server (linuxtechi.com)</a></p>
<p>仅需</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cockpit</span><br><span class="line">sudo systemctl start cockpit</span><br></pre></td></tr></table></figure>

<p>端口为9090</p>
<p>要管理虚拟机需要安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cockpit-machines</span><br></pre></td></tr></table></figure>

<h3 id="LXD"><a href="#LXD" class="headerlink" title="LXD"></a>LXD</h3><p><a href="https://linuxcontainers.org/lxd/getting-started-cli/" target="_blank" rel="noopener">Linux Containers - LXD - Getting started</a></p>
<h4 id="LXDUI"><a href="#LXDUI" class="headerlink" title="LXDUI"></a>LXDUI</h4><p><a href="https://github.com/AdaptiveScale/lxdui" target="_blank" rel="noopener">AdaptiveScale/lxdui: LXDUI is a web UI for the native Linux container technology LXD/LXC (github.com)</a></p>
<ul>
<li><p>仓库提供了Dockerfile，但是readme中没有说</p>
</li>
<li><p>目前安装有库依赖的问题，需要patch一个pull request</p>
<ul>
<li>将pull request地址添加一个.patch后缀，便可以下载一个patch文件</li>
<li>git am pathfiel</li>
</ul>
</li>
<li><p>默认用户名密码：admin, admin</p>
</li>
</ul>
<h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><h4 id="中文输入法"><a href="#中文输入法" class="headerlink" title="中文输入法"></a>中文输入法</h4><p>使用了默认ibus的中文输入法，ctrl-空格切换延迟有500ms有点大。</p>
<h4 id="barrier"><a href="#barrier" class="headerlink" title="barrier"></a>barrier</h4><ol>
<li><p>问题1</p>
<p>直接安装barrier后，连接时日志显示没有SSL相关的.pem文件</p>
<p>需要手动生成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa</span><br></pre></td></tr></table></figure>
</li>
<li><p>问题2</p>
<p>barrier目前只支持xorg，因此需要关闭ubuntu22.04 wayland</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo vim &#x2F;etc&#x2F;gdm3&#x2F;custom.conf</span><br><span class="line"></span><br><span class="line">#设置</span><br><span class="line">WaylandEnable&#x3D;true --&gt; false</span><br><span class="line"></span><br><span class="line">sudo systemctl restart gdm3</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="aria2下载服务器"><a href="#aria2下载服务器" class="headerlink" title="aria2下载服务器"></a>aria2下载服务器</h4><ul>
<li><p>下载aria2：<a href="https://github.com/aria2/aria2" target="_blank" rel="noopener">aria2/aria2(github.com)</a></p>
<p>windows官方github有编译版，linux没有，可以从<a href="https://github.com/q3aql/aria2-static-builds" target="_blank" rel="noopener">q3aql/aria2-static-builds: aria2 static builds for GNU/Linux &amp; Windows (with OpenSSL). (github.com)</a>下载</p>
</li>
<li><p>service</p>
<p><a href="https://gist.github.com/h0tw1r3/ccf7668552fae5d14148" target="_blank" rel="noopener">Aria2c systemd service (github.com)</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;Aria2c download manager</span><br><span class="line">After&#x3D;network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;simple</span><br><span class="line">User&#x3D;www-data</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;aria2c --console-log-level&#x3D;warn --enable-rpc --rpc-listen-all --conf-path&#x3D;&#x2F;etc&#x2F;aria2.daemon</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
</li>
<li><p>web</p>
<ul>
<li><p>AriaNg</p>
<ul>
<li>只有一个html<a href="https://github.com/mayswind/AriaNg/releases" target="_blank" rel="noopener">Releases · mayswind/AriaNg (github.com)</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;Aria2 webUI</span><br><span class="line">After&#x3D;syslog.target network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;simple</span><br><span class="line">WorkingDirectory&#x3D;&#x2F;home&#x2F;yfy&#x2F;app&#x2F;aria2-1.36.0&#x2F;AriaNg</span><br><span class="line"></span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3 -m http.server 6801</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h4><p>install alternative Desktop Environments: <a href="https://www.howtogeek.com/193129/how-to-install-and-use-another-desktop-environment-on-linux/" target="_blank" rel="noopener">How to Install and Use Another Desktop Environment on Linux (howtogeek.com)</a></p>
<p>关键词：</p>
<ul>
<li><p>X windows sytem</p>
</li>
<li><p>Desktop environments</p>
<ul>
<li><p>window manager</p>
<blockquote>
<p>system software that controls the placement and appearance of windows within a windowing system in a graphical user interface (GUI). It can be part of a <a href="https://wiki.archlinux.org/title/Desktop_environment" target="_blank" rel="noopener">desktop environment</a> (DE) or be used standalone.</p>
</blockquote>
<blockquote>
<p>Window managers are <strong>X clients</strong> that control the appearance and behaviour of the frames (“windows”) where the various graphical applications are drawn. They determine the border, title bar, size, and ability to resize windows</p>
</blockquote>
<ul>
<li>Stacking </li>
<li>Tiling<ul>
<li>i3</li>
</ul>
</li>
</ul>
</li>
<li><p>applications</p>
</li>
</ul>
</li>
<li><p>Display manager(login manager)</p>
<blockquote>
<p>is typically a graphical user interface that is displayed at the end of the boot process in place of the default shell.</p>
</blockquote>
<ul>
<li><p><strong><a href="https://wiki.archlinux.org/title/GDM" target="_blank" rel="noopener">GDM</a></strong> — <a href="https://wiki.archlinux.org/title/GNOME" target="_blank" rel="noopener">GNOME</a> display manager.</p>
</li>
<li><p><strong><a href="https://wiki.archlinux.org/title/LightDM" target="_blank" rel="noopener">LightDM</a></strong> — Cross-desktop display manager, can use various front-ends written in any toolkit.</p>
</li>
<li><p>**[LXD — <a href="https://wiki.archlinux.org/title/LXDE" target="_blank" rel="noopener">LXDE</a> display manager. Can be used independent of the LXDE desktop environment.</p>
</li>
<li><p><strong><a href="https://wiki.archlinux.org/title/SDDM" target="_blank" rel="noopener">SDDM</a></strong> — QML-based display manager and successor to KDM; recommended for <a href="https://wiki.archlinux.org/title/Plasma" target="_blank" rel="noopener">Plasma</a> and <a href="https://wiki.archlinux.org/title/LXQt" target="_blank" rel="noopener">LXQt</a>.</p>
</li>
</ul>
<blockquote>
<p>The X server is usually started from the X Display Manager program xdm(1) or a  similar  display  manager        program.   This  utility  is run from the system boot files and takes care of keeping the server running,        prompting for usernames and passwords, and starting up the user sessions.</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>Desktop environments include basically everything you see after you log into your user account on your <a href="https://www.howtogeek.com/177213/linux-isnt-just-linux-8-pieces-of-software-that-make-up-linux-systems/" target="_blank" rel="noopener">Linux</a> distribution’s sign-in screen. The desktop itself, desktop background, panels, menus, file manager, settings windows, and many other applications and utilities all come from a desktop environment. Even each window’s titlebar is provided by an application known as a window manager that comes with the desktop environment.</p>
</blockquote>
<h5 id="X-Windows-System"><a href="#X-Windows-System" class="headerlink" title="X Windows System"></a>X Windows System</h5><p>man X(7)</p>
<p>X server有两种启动方式</p>
<ul>
<li>login manager</li>
<li>Xinit：不是给用户使用的，而是用于启动X server的工具</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">%  xrdb $HOME&#x2F;.Xresources</span><br><span class="line">%  xmodmap -e &quot;keysym BackSpace &#x3D; Delete&quot;</span><br><span class="line">%  mkfontdir &#x2F;usr&#x2F;local&#x2F;lib&#x2F;X11&#x2F;otherfonts</span><br><span class="line">%  xset fp+ &#x2F;usr&#x2F;local&#x2F;lib&#x2F;X11&#x2F;otherfonts</span><br><span class="line">%  xmodmap $HOME&#x2F;.keymap.km</span><br><span class="line">%  xsetroot -solid &#39;rgbi:.8&#x2F;.8&#x2F;.8&#39;</span><br><span class="line">%  xset b 100 400 c 50 s 1800 r on</span><br><span class="line">%  xset q</span><br><span class="line">%  twm</span><br><span class="line">%  xmag</span><br><span class="line">%  xclock -geometry 48x48-0+0 -bg blue -fg white</span><br><span class="line">%  xeyes -geometry 48x48-48+0</span><br><span class="line">%  xbiff -update 20</span><br><span class="line">%  xlsfonts &#39;*helvetica*&#39;</span><br><span class="line">%  xwininfo -root</span><br><span class="line">%  xdpyinfo -display joesworkstation:0</span><br><span class="line">%  xhost -joesworkstation</span><br><span class="line">%  xrefresh</span><br><span class="line">%  xwd | xwud</span><br><span class="line">%  bitmap companylogo.bm 32x32</span><br><span class="line">%  xcalc -bg blue -fg magenta</span><br><span class="line">%  xterm -geometry 80x66-0-0 -name myxterm $*</span><br></pre></td></tr></table></figure>

<p>man Xserver(1)</p>
<blockquote>
<p>The X server is usually started from the X Display Manager program xdm(1) or a  similar  display  manager        program.   This  utility  is run from the system boot files and takes care of keeping the server running,        prompting for usernames and passwords, and starting up the user sessions.</p>
<p>Installations that run more than one window system may need to use the xinit(1) utility instead of a dis‐        play manager.  However, xinit is to be considered a tool for building startup scripts and is not intended        for use by end users.  Site administrators are strongly urged to use a display manager,  or  build  other        interfaces for novice users.</p>
</blockquote>
<h5 id="切换桌面环境"><a href="#切换桌面环境" class="headerlink" title="切换桌面环境"></a>切换桌面环境</h5><ul>
<li><strong>xfce</strong>: <a href="https://docs.xfce.org/xfce/getting-started" target="_blank" rel="noopener">xfce:getting-started [Xfce Docs]</a></li>
<li><a href="https://www.howtogeek.com/193129/how-to-install-and-use-another-desktop-environment-on-linux/" target="_blank" rel="noopener">How to Install and Use Another Desktop Environment on Linux (howtogeek.com)</a></li>
</ul>
<h5 id="VNC"><a href="#VNC" class="headerlink" title="VNC"></a>VNC</h5><p>使用VNC并不需要使用到login manager</p>
<blockquote>
<p>During installation, you may be prompted to choose a default display manager for Xfce. A display manager is a program that allows you to select and log in to a desktop environment through a graphical interface. You’ll only be using Xfce when you connect with a VNC client, and in these Xfce sessions you’ll already be logged in as your non-root Ubuntu user. So for the purposes of this tutorial, your choice of display manager isn’t pertinent. Select either one and press <code>ENTER</code>.</p>
</blockquote>
<h3 id="Docker-node-hexo"><a href="#Docker-node-hexo" class="headerlink" title="Docker node/hexo"></a>Docker node/hexo</h3><h4 id="直接安装"><a href="#直接安装" class="headerlink" title="直接安装"></a>直接安装</h4><p>教程: <a href="https://hexo.io/zh-cn/docs/index.html" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/index.html</a></p>
<p>首先需要安装node.js和git，然后安装hexo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<p>常用hexo命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br><span class="line">hexo new &quot;aaa&quot;</span><br><span class="line"></span><br><span class="line">hexo clean #删除public目录(html)</span><br><span class="line">hexo g		#生成html</span><br><span class="line">hexo s -p PORT	#本地server</span><br><span class="line">hexo d		#部署</span><br></pre></td></tr></table></figure>

<h4 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h4><ol>
<li>基于node基本镜像，创建一个包含hexo环境的docker镜像，入口点为bash</li>
<li>运行该镜像，将blog目录映射到docker容器中，然后进行hexo操作</li>
<li>[可选]部署时为了避免输入github密码，可以将.ssh和.gitconfig映射到容器中</li>
</ol>
<h5 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h5><p>参考</p>
<ul>
<li><p>别人的dockerfile：<a href="https://wanf3ng.github.io/2021/01/29/使用docker搭建Hexo/" target="_blank" rel="noopener">使用docker搭建Hexo - wanf3ng’s blog</a></p>
</li>
<li><p>设置用户：<a href="https://blog.plusku.net/2020/08/08/docker-hexo/" target="_blank" rel="noopener">在docker中執行hexo | Plusku@blog</a></p>
</li>
</ul>
<p>说明：</p>
<ul>
<li>默认了用户uid=1000。因此可以直接指定User node来避免容器内生成的文件为root所有问题。</li>
<li>使用node12.0，否则hexo运行会失败</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">FROM node:12.6.0-alpine</span><br><span class="line"></span><br><span class="line"># 切换中科大源</span><br><span class="line">RUN sed -i &#39;s&#x2F;dl-cdn.alpinelinux.org&#x2F;mirrors.ustc.edu.cn&#x2F;g&#39; &#x2F;etc&#x2F;apk&#x2F;repositories</span><br><span class="line"># 安装bash git openssh</span><br><span class="line">RUN apk add bash git openssh</span><br><span class="line"></span><br><span class="line"># 设置容器时区为上海，不然发布文章的时间是国际时间，也就是比我们晚8个小时</span><br><span class="line">RUN apk add tzdata &amp;&amp; cp &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime \</span><br><span class="line">&amp;&amp; echo &quot;Asia&#x2F;Shanghai&quot; &gt; &#x2F;etc&#x2F;timezone \</span><br><span class="line">&amp;&amp; apk del tzdata</span><br><span class="line"></span><br><span class="line"># 安装hexo</span><br><span class="line">RUN \ </span><br><span class="line">npm config set registry https:&#x2F;&#x2F;registry.npm.taobao.org \</span><br><span class="line">&amp;&amp;npm install \</span><br><span class="line">&amp;&amp;npm install hexo-cli -g \</span><br><span class="line">&amp;&amp; npm install hexo-server --save \</span><br><span class="line">&amp;&amp; npm install hexo-asset-image --save \</span><br><span class="line">&amp;&amp; npm install hexo-wordcount --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-sitemap --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-baidu-sitemap --save \</span><br><span class="line">&amp;&amp; npm install hexo-deployer-git --save</span><br><span class="line"></span><br><span class="line">ARG GIT_NAME</span><br><span class="line">ARG GIT_EMAIL</span><br><span class="line"></span><br><span class="line">User node</span><br><span class="line"></span><br><span class="line"># 设置git push时的用户名和邮箱</span><br><span class="line">RUN \</span><br><span class="line">	git config --global user.email &quot;$GIT_EMAIL&quot; \</span><br><span class="line">	&amp;&amp; git config --global user.name &quot;$GIT_NAME&quot;</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;home&#x2F;node&#x2F;blog</span><br><span class="line"></span><br><span class="line">EXPOSE 4000</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;&#x2F;bin&#x2F;bash&quot;]</span><br></pre></td></tr></table></figure>

<h5 id="build镜像"><a href="#build镜像" class="headerlink" title="build镜像"></a>build镜像</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -t yfy&#x2F;hexo-blog\</span><br><span class="line">	--build-arg GIT_NAME&#x3D;&quot;Fuyan Yuan&quot;\</span><br><span class="line">	--build-arg GIT_EMAIL&#x3D;&quot;33221728+TheRainstorm@users.noreply.github.com&quot;\</span><br><span class="line">	.</span><br></pre></td></tr></table></figure>

<h5 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name hexo-blog\</span><br><span class="line">	-p 4000:4000 \</span><br><span class="line">	-v &#x2F;home&#x2F;yfy&#x2F;Documents&#x2F;hexo-blog:&#x2F;home&#x2F;node&#x2F;blog&#x2F; \</span><br><span class="line">	-v &#x2F;home&#x2F;yfy&#x2F;.ssh:&#x2F;home&#x2F;node&#x2F;.ssh\</span><br><span class="line">	yfy&#x2F;hexo-blog</span><br></pre></td></tr></table></figure>

<p>如果blog下没有node_modules，则需要</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>之后正常使用hexo即可</p>
<blockquote>
<p> docker技巧：连接到已有容器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker attach CONTAINER</span><br><span class="line">docker exec -it CONTAINER CMD</span><br></pre></td></tr></table></figure>

<p><code>attach</code>命令将终端的标准输入，标准输出，标准错误连接到正在运行的容器。如果容器正在运行的命令是bash，则exit后，容器退出</p>
<p><code>exec</code>命令在容器内启动新的进程。常见如bash</p>
</blockquote>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><h4 id="network"><a href="#network" class="headerlink" title="network"></a>network</h4><p><a href="https://docs.docker.com/network/" target="_blank" rel="noopener">https://docs.docker.com/network/</a></p>
<h5 id="host"><a href="#host" class="headerlink" title="host"></a>host</h5><ul>
<li>容器不会获得自己的ip</li>
<li>如果容器绑定在80端口，则访问主机ip的80端口即可</li>
<li>有利于优化性能</li>
<li>只在linux上支持</li>
</ul>
<p>设置方法</p>
<ul>
<li><p>docker run</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--network host</span><br></pre></td></tr></table></figure>
</li>
<li><p>compose</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">network_mode: &quot;host&quot;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="bridge"><a href="#bridge" class="headerlink" title="bridge"></a>bridge</h5><ul>
<li><p>默认bridge缺点</p>
<blockquote>
<p>If you do not specify a network using the <code>--network</code> flag, and you do specify a network driver, your container is connected to the default <code>bridge</code> network by default. Containers connected to the default <code>bridge</code> network can communicate, but only by IP address, unless they are linked using the <a href="https://docs.docker.com/network/links/" target="_blank" rel="noopener">legacy <code>--link</code> flag</a>.</p>
</blockquote>
</li>
<li><p>自己创建network</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker network create my-net</span><br><span class="line">docker network rm my-net</span><br><span class="line"></span><br><span class="line">#创建容器时指定网络</span><br><span class="line">docker create --network</span><br><span class="line"></span><br><span class="line">#连接已有容器</span><br><span class="line">docker network connect my-net my-nginx</span><br><span class="line">docker network disconnect my-net my-nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置默认bridge</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;bip&quot;: &quot;192.168.1.1&#x2F;24&quot;,</span><br><span class="line">  &quot;fixed-cidr&quot;: &quot;192.168.1.0&#x2F;25&quot;,</span><br><span class="line">  &quot;fixed-cidr-v6&quot;: &quot;2001:db8::&#x2F;64&quot;,</span><br><span class="line">  &quot;mtu&quot;: 1500,</span><br><span class="line">  &quot;default-gateway&quot;: &quot;192.168.1.254&quot;,</span><br><span class="line">  &quot;default-gateway-v6&quot;: &quot;2001:db8:abcd::89&quot;,</span><br><span class="line">  &quot;dns&quot;: [&quot;10.20.1.2&quot;,&quot;10.20.1.3&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="自启动"><a href="#自启动" class="headerlink" title="自启动"></a>自启动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update --restart&#x3D;always</span><br></pre></td></tr></table></figure>

<h4 id="ipv6"><a href="#ipv6" class="headerlink" title="ipv6"></a>ipv6</h4><p>参考：<a href="https://www.linode.com/community/questions/20842/how-do-i-enable-ipv6-support-for-docker-containers" target="_blank" rel="noopener">How Do I Enable IPv6 Support for Docker Containers? | Linode Questions</a></p>
<p>If you need IPv6 support for Docker containers, you need to <a href="https://docs.docker.com/config/daemon/ipv6/" target="_blank" rel="noopener">enable the option</a> on the Docker daemon and reload its configuration, before creating any IPv6 networks or assigning containers IPv6 addresses.</p>
<p>When you create your network, you can specify the <code>--ipv6</code> flag to enable IPv6. You can’t selectively disable IPv6 support on the default <code>bridge</code> network.</p>
<p>开启ipv6后，默认brdige自动配置了ipv6，无法关闭（自己创建的bridge network才可以不启用ipv6）</p>
<blockquote>
<p>If you configure Docker for IPv6 support (see <a href="https://docs.docker.com/network/bridge/#use-ipv6" target="_blank" rel="noopener">Use IPv6</a>), the default bridge network is also configured for IPv6 automatically. Unlike user-defined bridges, you can’t selectively disable IPv6 on the default bridge.</p>
</blockquote>
<p>我的路由器得到的ipv6是<code>2001:da8:d800:336:8e53:c3ff:fe86:123d/64</code>，应该是有一个block的。但是当我设置了daemon.json内<code>fixed-cidr-v6</code>为<code>2001:da8:d800:336::/64</code>后。默认的bridge docker0显示ip是<code>2001:da8:d800:336::1/64</code>。容器内确实获得了ipv6地址，但是无法ping通host物理网卡上的ipv6地址。也无法ping通路由器。</p>
<ul>
<li>所以感觉路由器得到的/64的块并不属于我，没办法这样配置。</li>
<li>可能还是得配置nat。但是使用ipv6的还是少数（PT下载需要），因此还是使用host网络类型吧。</li>
</ul>
<h3 id="Docker应用"><a href="#Docker应用" class="headerlink" title="Docker应用"></a>Docker应用</h3><h4 id="transmission-PT下载"><a href="#transmission-PT下载" class="headerlink" title="transmission PT下载"></a>transmission PT下载</h4><p>说明：transmission是linux下的BT下载软件，可以通过网页控制，有docker版本。</p>
<p>挑战：由于PT一般是只能ipv6访问的，因此要求docker容器能够ipv6访问。发现最简单的方式就是网络类型选择host。</p>
<p>以下docker compose是transmission官方提供的，主要修改了其中network_mode。</p>
<ul>
<li>其中TRANSMISSION_WEB_HOME指定网页皮肤，使用<a href="https://github.com/ronggang/transmission-web-control" target="_blank" rel="noopener">ronggang/transmission-web-control: 一个 Transmission 浏览器管理界面。Transmission Web Control is a custom web UI. (github.com)</a></li>
<li>使用它的脚本安装有点问题，主要是网络下载不下来。<ul>
<li>将git仓库中的src目录覆盖到容器中原本的web目录即可</li>
<li>然后最好修改一下TRANSMISSION_WEB_HOME位置</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">version: &quot;2.1&quot;</span><br><span class="line">services:</span><br><span class="line">  transmission:</span><br><span class="line">    image: lscr.io&#x2F;linuxserver&#x2F;transmission:latest</span><br><span class="line">    container_name: transmission</span><br><span class="line">    environment:</span><br><span class="line">      - PUID&#x3D;1000</span><br><span class="line">      - PGID&#x3D;1000</span><br><span class="line">      - TZ&#x3D;ASIA&#x2F;ShangHai</span><br><span class="line">      - USER&#x3D;yfy</span><br><span class="line">      - PASS&#x3D;abcd4567</span><br><span class="line">      - PEERPORT&#x3D;51413</span><br><span class="line">      - TRANSMISSION_WEB_HOME&#x3D;&#x2F;downloads&#x2F;transmission&#x2F;web</span><br><span class="line">    volumes:</span><br><span class="line">      - &#x2F;home&#x2F;yfy&#x2F;Disk&#x2F;BT&#x2F;config:&#x2F;config</span><br><span class="line">      - &#x2F;home&#x2F;yfy&#x2F;Disk&#x2F;BT&#x2F;downloads:&#x2F;downloads</span><br><span class="line">      - &#x2F;home&#x2F;yfy&#x2F;Disk&#x2F;BT&#x2F;watch:&#x2F;watch</span><br><span class="line">    network_mode: &quot;host&quot;</span><br><span class="line">    restart: unless-stopped</span><br></pre></td></tr></table></figure>

<h4 id="jellyfin"><a href="#jellyfin" class="headerlink" title="jellyfin"></a>jellyfin</h4>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/docker/" rel="tag"># docker</a>
              <a href="/tags/ntfs/" rel="tag"># ntfs</a>
              <a href="/tags/samba/" rel="tag"># samba</a>
              <a href="/tags/portainer/" rel="tag"># portainer</a>
              <a href="/tags/KVM/" rel="tag"># KVM</a>
              <a href="/tags/LXD/" rel="tag"># LXD</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/07/01/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%BD%91%E7%BB%9C%E9%A3%8E%E6%B3%A2/" rel="prev" title="实验室网络风波">
      <i class="fa fa-chevron-left"></i> 实验室网络风波
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/07/16/Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/" rel="next" title="Linux安装windows虚拟机并显卡直通">
      Linux安装windows虚拟机并显卡直通 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#linux挂载ntfs分区"><span class="nav-number">1.</span> <span class="nav-text">linux挂载ntfs分区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#linux分享Samba"><span class="nav-number">2.</span> <span class="nav-text">linux分享Samba</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命令行分区"><span class="nav-number">3.</span> <span class="nav-text">命令行分区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-portainer"><span class="nav-number">4.</span> <span class="nav-text">docker,portainer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装docker"><span class="nav-number">4.1.</span> <span class="nav-text">安装docker</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装portainer"><span class="nav-number">4.2.</span> <span class="nav-text">安装portainer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KVM-cockpit"><span class="nav-number">5.</span> <span class="nav-text">KVM, cockpit</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#KVM-install"><span class="nav-number">5.1.</span> <span class="nav-text">KVM install</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KVM-install-win10"><span class="nav-number">5.2.</span> <span class="nav-text">KVM install win10</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CLI"><span class="nav-number">5.3.</span> <span class="nav-text">CLI</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#基本"><span class="nav-number">5.3.1.</span> <span class="nav-text">基本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#开启VNC"><span class="nav-number">5.3.2.</span> <span class="nav-text">开启VNC</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cockpit"><span class="nav-number">5.4.</span> <span class="nav-text">Cockpit</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LXD"><span class="nav-number">6.</span> <span class="nav-text">LXD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LXDUI"><span class="nav-number">6.1.</span> <span class="nav-text">LXDUI</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其它"><span class="nav-number">7.</span> <span class="nav-text">其它</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#中文输入法"><span class="nav-number">7.1.</span> <span class="nav-text">中文输入法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#barrier"><span class="nav-number">7.2.</span> <span class="nav-text">barrier</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#aria2下载服务器"><span class="nav-number">7.3.</span> <span class="nav-text">aria2下载服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GUI"><span class="nav-number">7.4.</span> <span class="nav-text">GUI</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#X-Windows-System"><span class="nav-number">7.4.1.</span> <span class="nav-text">X Windows System</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#切换桌面环境"><span class="nav-number">7.4.2.</span> <span class="nav-text">切换桌面环境</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#VNC"><span class="nav-number">7.4.3.</span> <span class="nav-text">VNC</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-node-hexo"><span class="nav-number">8.</span> <span class="nav-text">Docker node&#x2F;hexo</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#直接安装"><span class="nav-number">8.1.</span> <span class="nav-text">直接安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#docker安装"><span class="nav-number">8.2.</span> <span class="nav-text">docker安装</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#dockerfile"><span class="nav-number">8.2.1.</span> <span class="nav-text">dockerfile</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#build镜像"><span class="nav-number">8.2.2.</span> <span class="nav-text">build镜像</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#运行"><span class="nav-number">8.2.3.</span> <span class="nav-text">运行</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker"><span class="nav-number">9.</span> <span class="nav-text">Docker</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#network"><span class="nav-number">9.1.</span> <span class="nav-text">network</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#host"><span class="nav-number">9.1.1.</span> <span class="nav-text">host</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#bridge"><span class="nav-number">9.1.2.</span> <span class="nav-text">bridge</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自启动"><span class="nav-number">9.2.</span> <span class="nav-text">自启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ipv6"><span class="nav-number">9.3.</span> <span class="nav-text">ipv6</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker应用"><span class="nav-number">10.</span> <span class="nav-text">Docker应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#transmission-PT下载"><span class="nav-number">10.1.</span> <span class="nav-text">transmission PT下载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jellyfin"><span class="nav-number">10.2.</span> <span class="nav-text">jellyfin</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="rain"
      src="/images/images_lx/avatar_idenn.png">
  <p class="site-author-name" itemprop="name">rain</p>
  <div class="site-description" itemprop="description">记录一些关于数学、计算机的知识，以及一些日常。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">88</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">106</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/TheRainstorm" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;TheRainstorm" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1544016010@qq.com" title="E-Mail → mailto:1544016010@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rain</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'o4cQoSCyl8A6rNyF3TQecBOG-gzGzoHsz',
      appKey     : 'RN9rQAQldGQFicEMmzpFUcMA',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
