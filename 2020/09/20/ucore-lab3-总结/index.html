<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="概述先写了关于一个线程创建，执行的过程。do_exit等其它函数待完善">
<meta property="og:type" content="article">
<meta property="og:title" content="ucore lab3 总结">
<meta property="og:url" content="http://yoursite.com/2020/09/20/ucore-lab3-%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="rain的随笔">
<meta property="og:description" content="概述先写了关于一个线程创建，执行的过程。do_exit等其它函数待完善">
<meta property="og:locale" content="zh">
<meta property="og:image" content="c:%5CUsers%5CFuyanYuan%5CDesktop%5Cimages%5Cucore_lab4%5Cimage-20200920200402375.png">
<meta property="article:published_time" content="2020-09-20T15:52:30.000Z">
<meta property="article:modified_time" content="2020-09-20T15:57:11.040Z">
<meta property="article:author" content="rain">
<meta property="article:tag" content="数学 计算机 御坂美琴">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:%5CUsers%5CFuyanYuan%5CDesktop%5Cimages%5Cucore_lab4%5Cimage-20200920200402375.png">

<link rel="canonical" href="http://yoursite.com/2020/09/20/ucore-lab3-%E6%80%BB%E7%BB%93/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>ucore lab3 总结 | rain的随笔</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">rain的随笔</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">A secret base!</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">25</span></a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/20/ucore-lab3-%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/images_lx/avatar_idenn.png">
      <meta itemprop="name" content="rain">
      <meta itemprop="description" content="记录一些关于数学、计算机的知识，以及一些日常。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rain的随笔">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ucore lab3 总结
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-09-20 23:52:30 / Modified: 23:57:11" itemprop="dateCreated datePublished" datetime="2020-09-20T23:52:30+08:00">2020-09-20</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/09/20/ucore-lab3-%E6%80%BB%E7%BB%93/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/09/20/ucore-lab3-%E6%80%BB%E7%BB%93/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>先写了关于一个线程创建，执行的过程。do_exit等其它函数待完善</p>
<a id="more"></a>

<h3 id="x86中断-异常处理"><a href="#x86中断-异常处理" class="headerlink" title="x86中断/异常处理"></a>x86中断/异常处理</h3><p><em>p.s. 见x86 manual Vol. 1 6-11</em></p>
<p>If the code segment for the handler procedure has the same privilege level as the currently executing program or task, the handler procedure uses the current stack; if the handler executes at a more privileged level, the processor switches to the stack for the handler’s privilege level.</p>
<p><strong>Call</strong></p>
<p>If no stack switch occurs, the processor does the following when calling an interrupt or exception handler (see Figure 6-5):</p>
<ol>
<li>Pushes the current contents of the <strong>EFLAGS</strong>, CS, and <strong>EIP</strong> registers (in that order) on the stack.</li>
<li>Pushes an <strong>error code</strong> (if appropriate) on the stack.</li>
<li>Loads the segment selector for the new code segment and the new instruction pointer (from the interrupt gate or trap gate) into the CS and EIP registers, respectively.</li>
<li>If the call is through an interrupt gate, clears the <strong>IF flag</strong> in the EFLAGS register.</li>
<li>Begins execution of the handler procedure.</li>
</ol>
<p>If a stack switch does occur, the processor does the following:</p>
<ol>
<li>Temporarily saves (internally) the current contents of the SS, ESP, EFLAGS, CS, and EIP registers.</li>
<li>Loads the segment selector and stack pointer for the new stack (that is, the stack for the privilege level being called) <strong>from the TSS into the SS and ESP registers</strong> and switches to the new stack.</li>
<li>Pushes the temporarily saved SS, ESP, EFLAGS, CS, and EIP values for the interrupted procedure’s stack onto the new stack.</li>
<li>Pushes an error code on the new stack (if appropriate).</li>
<li>Loads the segment selector for the new code segment and the new instruction pointer (from the interrupt gate or trap gate) into the CS and EIP registers, respectively.</li>
<li>If the call is through an interrupt gate, clears the IF flag in the EFLAGS register.</li>
<li>Begins execution of the handler procedure at the new privilege level.</li>
</ol>
<p><strong>return</strong></p>
<p>A return from an interrupt or exception handler is initiated with the IRET instruction. The IRET instruction is similar to the far RET instruction, except that it also restores the contents of the EFLAGS register for the interrupted proce-dure. </p>
<p>When executing a return from an interrupt or exception handler from the same privilege level as the inter-rupted procedure, the processor performs these actions:</p>
<ol>
<li>Restores the CS and EIP registers to their values prior to the interrupt or exception.</li>
<li>Restores the EFLAGS register.</li>
<li>Increments the stack pointer appropriately.</li>
<li>Resumes execution of the interrupted procedure.</li>
</ol>
<p>When executing a return from an interrupt or exception handler from a different privilege level than the interrupted procedure, the processor performs these actions:</p>
<ol>
<li>Performs a privilege check.</li>
<li>Restores the CS and EIP registers to their values prior to the interrupt or exception.</li>
<li>Restores the EFLAGS register.</li>
<li>Restores the SS and ESP registers to their values prior to the interrupt or exception, resulting in a stack switch back to the stack of the interrupted procedure.</li>
<li>Resumes execution of the interrupted procedure.</li>
</ol>
<p><img src="C:%5CUsers%5CFuyanYuan%5CDesktop%5Cimages%5Cucore_lab4%5Cimage-20200920200402375.png" alt="image-20200920200402375"></p>
<p>总结：</p>
<p>发生中断，无特权级转换时，使用原本的栈来存储中断帧。发生特权级转换时（好像只有用户态到内核态），使用当前进程tss中的ss0, esp0所指向的栈（内核栈）来存储中断帧，且cpu会在中断帧中额外存储当前的ss和esp。（<em>p.s. cpu通过比较中断向量指向的中断描述符和cs寄存器来检测是否存在特权级的转换。而执行iret时，cpu通过比较栈中的cs和cs寄存器来检测是否需要特权级的转换</em>）</p>
<h3 id="重要函数说明"><a href="#重要函数说明" class="headerlink" title="重要函数说明"></a>重要函数说明</h3><ol>
<li><p>kernel_thread</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int kernel_thread(int (*fn)(void *), void *arg, uint32_t clone_flags)</span><br></pre></td></tr></table></figure>

<p>作用：创建一个内核线程，该线程将执行fn函数，参数为arg，clone_flags控制是否共享父进程内存，返回线程pid。</p>
<p>实现：</p>
<ol>
<li><p>设置tf</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tf.tf_regs.reg_ebx = (<span class="keyword">uint32_t</span>)fn;</span><br><span class="line">tf.tf_regs.reg_edx = (<span class="keyword">uint32_t</span>)arg;</span><br><span class="line">tf.tf_eip = (<span class="keyword">uint32_t</span>)kernel_thread_entry;</span><br></pre></td></tr></table></figure>
<p>其中kernel_thread_entry如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kernel_thread_entry:        # void kernel_thread(void)</span><br><span class="line"></span><br><span class="line">    pushl %edx              # push arg</span><br><span class="line">    call *%ebx              # call fn</span><br><span class="line"></span><br><span class="line">    pushl %eax              # save the return value of fn(arg)</span><br><span class="line">    call do_exit            # call do_exit to terminate current thread</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>中断帧中的eip被设置为了kernel_thread_entry，如果让cpu根据该中断帧返回，cpu便会回到kernel_thread_entry，然后由于通用寄存器ebx, edx也已经恢复成fn, arg的值，因而可以成功调用fn函数。</p>
<p>后面copy_thread函数中会将线程初始context中的eip设置为forkret的位置，而forkret的处理就是复用中断处理返回的逻辑，从当前线程的中断帧返回。因此当线程创建后第一次被schedule到的时候，上下文切换函数switch_to，便会回到forkret的位置，从而如上所示进行一系列操作，最终成功调用fn函数。</p>
<p>当线程结束时会调用do_exit</p>
</li>
<li><p>调用do_fork</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">do_fork(clone_flags | CLONE_VM, 0, &amp;tf);</span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ol>
<ol start="2">
<li><p>do_fork</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* do_fork -     parent process for a new child process</span><br><span class="line"> * @clone_flags: used to guide how to clone the child process</span><br><span class="line"> * @stack:       the parent&#39;s user stack pointer. if stack&#x3D;&#x3D;0, It means to fork a kernel thread.</span><br><span class="line"> * @tf:          the trapframe info, which will be copied to child process&#39;s proc-&gt;tf</span><br><span class="line"> *&#x2F;</span><br><span class="line">int</span><br><span class="line">do_fork(uint32_t clone_flags, uintptr_t stack, struct trapframe *tf)</span><br></pre></td></tr></table></figure>

<p>作用：用于实现kernel_thread</p>
<p>实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;    1. call alloc_proc to allocate a proc_struct</span><br><span class="line">&#x2F;&#x2F;    2. call setup_kstack to allocate a kernel stack for child process (8KB)</span><br><span class="line">&#x2F;&#x2F;    3. call copy_mm to dup OR share mm according clone_flag</span><br><span class="line">&#x2F;&#x2F;    4. call copy_thread to setup tf &amp; context in proc_struct</span><br><span class="line">&#x2F;&#x2F;    5. insert proc_struct into hash_list &amp;&amp; proc_list</span><br><span class="line">&#x2F;&#x2F;    6. call wakeup_proc to make the new child process RUNNABLE</span><br><span class="line">&#x2F;&#x2F;    7. set ret vaule using child proc&#39;s pid</span><br></pre></td></tr></table></figure>

<ol>
<li><p>alloc_proc, 分配一个pcb结构体</p>
</li>
<li><p>setup_kstack, 分配内核栈空间(8KB)</p>
</li>
<li><p>copy_mm, 复制页表/共享页表</p>
</li>
<li><p>copy_thread, 设置tf, context</p>
<p>中断帧位于内核栈顶部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proc-&gt;tf &#x3D; (struct trapframe *)(proc-&gt;kstack + KSTACKSIZE) - 1;</span><br></pre></td></tr></table></figure>

<p>设置线程context的初始状态，eip设置为forkret</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   proc-&gt;context.eip &#x3D; (uintptr_t)forkret;</span><br><span class="line">proc-&gt;context.esp &#x3D; (uintptr_t)(proc-&gt;tf); #更新栈顶位置</span><br></pre></td></tr></table></figure>
</li>
<li><p>get_pid, 设置进程pid</p>
<p>hash_proc, 将进程添加到哈希表hash_list</p>
<p>set_links, 将进程添加到进程双向链表proc_list，并将进程设置为其父进程最小的子进程cptr</p>
</li>
<li><p>wakeup_proc, 将进程设置为runnable</p>
</li>
</ol>
</li>
<li><p>copy_mm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">static int</span><br><span class="line">copy_mm(uint32_t clone_flags, struct proc_struct *proc)</span><br></pre></td></tr></table></figure>

<p>作用：</p>
<p><code>clone_flags &amp; CLONE_VM</code>为真时，proc的mm设置为current-&gt;mm，即和当前进程共享内存。</p>
<p>（vma一致，因此进程有效的虚拟内存空间一致。页表一致，因此访问同一份物理地址）</p>
<p>否则，复制当前进程的虚拟内存(vma)，复制物理内存并设置对应的页表。（复制了当前进程的内存）</p>
<p>实现：</p>
<p>copy_mm</p>
<p>-&gt; dup_mmap, 调用copy_range复制每一个vma</p>
<p>-&gt; copy_range, 复制一段虚拟地址对应的物理内存，并设置页表</p>
</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/09/14/ucore-lab2%E6%80%BB%E7%BB%93/" rel="prev" title="ucore lab2总结">
      <i class="fa fa-chevron-left"></i> ucore lab2总结
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#x86中断-异常处理"><span class="nav-number">1.1.</span> <span class="nav-text">x86中断&#x2F;异常处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重要函数说明"><span class="nav-number">1.2.</span> <span class="nav-text">重要函数说明</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="rain"
      src="/images/images_lx/avatar_idenn.png">
  <p class="site-author-name" itemprop="name">rain</p>
  <div class="site-description" itemprop="description">记录一些关于数学、计算机的知识，以及一些日常。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/TheRainstorm" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;TheRainstorm" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1544016010@qq.com" title="E-Mail → mailto:1544016010@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rain</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'o4cQoSCyl8A6rNyF3TQecBOG-gzGzoHsz',
      appKey     : 'RN9rQAQldGQFicEMmzpFUcMA',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
